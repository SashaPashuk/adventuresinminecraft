import API from"../js/services/api.js";import{APP_LANGUAGES,DEFAULT_LANGUAGE}from"./contants/constants.js";import{renderCurrenciesToDropdownHTML,renderLanguagesToDropdownHTML}from"./utils/helpers.js";import{ContentLoadingEventObserever}from"./utils/observer.js";import{addCurrenciesSelectorEventListener,bindCurrenciesSwitcher,redirectForEnPaths,redirectForHomePaths}from"./utils/utils.js";const menuItems=document.querySelectorAll(".nav-link"),navItemsForUserLogic=document.querySelectorAll(".nav-item-user-logic"),navItemForUserDropdownLogic=document.querySelector(".nav-item-user-dd-logic"),usernameElement=document.querySelector("#username"),dropdownElement=(menuItems.forEach(function(e){e.getAttribute("href")===window.location.pathname&&e.classList.add("active")}),document.addEventListener("DOMContentLoaded",async()=>{redirectForHomePaths(),redirectForEnPaths(),await new Promise(e=>setTimeout(e,100));var e=window.location.pathname.includes("/ru/")?"ru":localStorage.getItem("language")||DEFAULT_LANGUAGE,e=(console.log("detectedLanguage",e),"ru"===e&&"/"===window.location.pathname&&window.open(window.location.origin+"/ru","_self"),localStorage.getItem("tokens")),t=localStorage.getItem("username"),t=(renderUserOptions(e,t),localStorage.getItem("orderItems")),o=await API.getShopCurrenciesRequest(),n=e?await API.getShopOrderItems():[],e=e?n:t&&JSON.parse(t)||[],n=document.querySelector(".cart-container-count");n&&(n.innerHTML=e.length||0),setTimeout(bindCurrenciesSwitcher,100),renderCurrenciesToDropdownHTML(o),renderLanguagesToDropdownHTML(APP_LANGUAGES),addCurrenciesSelectorEventListener(),addLanguageSelectorEventListener(),addCookieEventListener(),ContentLoadingEventObserever.broadcast(!0)}),document.querySelector(".dropdown")),dropdownSelectionElement=document.querySelector(".dropdown-selection"),dropdownItems=document.querySelectorAll(".dropdown-container li a"),closeModalElement=(dropdownItems?.forEach(function(e){e.getAttribute("href")===window.location.pathname&&e.classList.add("active")}),dropdownSelectionElement?.addEventListener("click",()=>{dropdownElement.classList.toggle("dropdown-open")}),document.querySelector(".exitConfirmation-modal-container-close-icon")),closeSuccessPaymentModalElement=(closeModalElement?.addEventListener("click",()=>{window.history.back()}),document.querySelector(".successPayment-modal-container-close-icon")),logoutButtonElement=(closeSuccessPaymentModalElement?.addEventListener("click",()=>{window.history.back()}),document.querySelector("#logout-button")),addLanguageSelectorEventListener=(logoutButtonElement?.addEventListener("click",()=>{localStorage.removeItem("tokens")}),()=>{const r=document.querySelector(".custom-select");r&&(r.addEventListener("change",e=>{r.querySelector("select").classList.remove("active")}),r.addEventListener("mousedown",e=>{if(r.querySelector("select").classList.add("active"),420<=window.innerWidth&&(e.preventDefault(),!r.querySelector(".selector-options"))){const o=r.children[0],n=document.createElement("ul");n.className="selector-options",[...o.children].forEach(t=>{var e=document.createElement("li");e.textContent=t.textContent,e.addEventListener("mousedown",e=>{o.value!==t.value&&(e.stopPropagation(),o.value=t.value,r.value=t.value,o.dispatchEvent(new Event("change")),r.dispatchEvent(new Event("change")),n.remove())}),n.appendChild(e)}),r.appendChild(n),document.addEventListener("click",e=>{r.contains(e.target)||(r.querySelector("select").classList.remove("active"),n.remove())})}}))}),addCookieEventListener=()=>{var e=localStorage.getItem("hasAcceptedCookie");document?.querySelector(".cookie_container")&&(e||document?.querySelector(".cookie_container")?.classList.remove("hidden"),document.querySelector("#cookieButton").addEventListener("click",()=>{localStorage.setItem("hasAcceptedCookie","true"),document?.querySelector(".cookie_container")?.classList.add("hidden")}))},renderUserOptions=(e,t)=>{e?(navItemForUserDropdownLogic?.classList.remove("hidden-visibility"),navItemsForUserLogic?.forEach(e=>e.classList.add("hidden")),t&&usernameElement&&(usernameElement.innerHTML=t.slice(0,15)+"...",usernameElement.setAttribute("title",t))):(navItemForUserDropdownLogic?.classList.add("hidden"),navItemsForUserLogic?.forEach(e=>e.classList.remove("hidden-visibility")))};