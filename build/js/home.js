import API from"../js/services/api.js";import{addToastNotification,renderShopItemsListHTML}from"./utils/helpers.js";import{LanguageEventObserever}from"./utils/observer.js";import{getLocalizedError}from"./services/errorsLanguageLocalization.js";import{ITEM_ADDED_TO_CART_ERROR,TOKEN_NOT_EXISTS,errorsLanguageLocalizationsEnum}from"./contants/errors.js";import{DEFAULT_LANGUAGE,SHOP_ITEM_TIME_USAGE,SHOP_ITEM_TYPES}from"./contants/constants.js";LanguageEventObserever.subscribe(async e=>{var t=document.querySelector('input[type="radio"]'),t=(t?.setAttribute("checked","true"),t?.classList.add("checked"),await API.getShopItems(e.language,{type:SHOP_ITEM_TYPES.Survival}));renderShopItemsListHTML(t),addProductCartButtonsEventListeners(),addProductCardsEventListeners(t),addShopItemsTypeSwitchEventListener()}),document.addEventListener("DOMContentLoaded",async()=>{var e=document.querySelector('input[type="radio"]'),e=(e?.setAttribute("checked","true"),e?.classList.add("checked"),await API.getShopItems(DEFAULT_LANGUAGE,{type:SHOP_ITEM_TYPES.Survival}));renderShopItemsListHTML(e),addProductCartButtonsEventListeners(),addProductCardsEventListeners(e),addShopItemsTypeSwitchEventListener()});const addProductCardsEventListeners=r=>{document.querySelectorAll(".products-card")?.forEach((e,t)=>{e.addEventListener("click",()=>{localStorage.setItem("item_data",JSON.stringify({id:r?.results[t].id,type:r?.results[t].type})),window.open("/pages/product","_self")})})},addProductCartButtonsEventListeners=()=>{var e=document.querySelectorAll(".products-card__buy");const r=document.querySelector(".cart-container-count");e?.forEach(t=>{t.addEventListener("click",async e=>{e.stopPropagation(),e.preventDefault();e=await API.addShopItemToCart({amount:1,item_id:t.getAttribute("data-id"),time_to_use:SHOP_ITEM_TIME_USAGE["30_DAYS"]});e?.detail===TOKEN_NOT_EXISTS&&addToastNotification({message:getLocalizedError(errorsLanguageLocalizationsEnum.USER_SHOULD_LOGIN_FIRST)}),e===ITEM_ADDED_TO_CART_ERROR&&addToastNotification({message:getLocalizedError(errorsLanguageLocalizationsEnum.ITEM_ADDED_TO_CART_ERROR)}),e!==ITEM_ADDED_TO_CART_ERROR&&e?.detail!==TOKEN_NOT_EXISTS&&(addToastNotification({message:getLocalizedError(errorsLanguageLocalizationsEnum.ITEM_ADDED_TO_CART_SUCCESS)}),r.innerHTML=Number(r.innerHTML)+1)})})},addShopItemsTypeSwitchEventListener=()=>{var e=document.querySelector(".products-svitch");const r=document.querySelectorAll(".products-svitch input");e?.addEventListener("change",async e=>{const t=e.target.value;e=await API.getShopItems(DEFAULT_LANGUAGE,{type:t});r?.forEach(e=>{e.value===t?(e.setAttribute("checked","true"),e.classList.add("checked")):(e.removeAttribute("checked"),e.classList.remove("checked"))}),renderShopItemsListHTML(e),addProductCartButtonsEventListeners(),addProductCardsEventListeners(e)})};