const API_URL="https://api.adventuresinminecraft.com/api/v1",getTokens=()=>{var e=localStorage.getItem("tokens");return JSON.parse(e)},sendAPIRequest=async({method:t,pathname:o,body:s,hasToken:a})=>{var e=async()=>{var e=a?{Authorization:"Bearer "+getTokens().access}:{};return(await fetch(API_URL+o,{method:t,body:s&&JSON.stringify(s)||void 0,headers:{"Content-Type":"application/json",...e},redirect:"follow"})).json()};const n=await e();if("token_not_valid"===n?.code){const n=await sendAPIRequestToRefreshToken();if(n?.access)return e();window.location.href="/pages/login.html",localStorage.removeItem("tokens")}return n},sendAPIRequestToRefreshToken=async()=>{const t=getTokens();var e=(await fetch(API_URL+"/user/refresh_token/",{method:"POST",body:JSON.stringify({refresh:t.refresh}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.access},redirect:"follow"})).json();return e.then(e=>{localStorage.setItem("tokens",JSON.stringify({...t,access:e.access}))}),e};export default{signup:e=>sendAPIRequest({method:"POST",pathname:"/user/register/",body:e}),login:e=>sendAPIRequest({method:"POST",pathname:"/user/login/",body:e}),getShopOrderItems:()=>sendAPIRequest({method:"GET",pathname:"/shop/order_items/",hasToken:!0}),getShopItems:(e,t)=>sendAPIRequest({method:"GET",pathname:`/shop/${e}/list/?type=`+t.type}),addShopItemToCart:e=>sendAPIRequest({method:"POST",pathname:`/shop/add_to_basket/${e}/`,hasToken:!0}),deleteShopItemFromCart:e=>sendAPIRequest({method:"POST",pathname:`/shop/delete_from_basket/${e}/`,hasToken:!0}),updateShopItemInCart:(e,t)=>sendAPIRequest({method:"POST",pathname:`/shop/order_item_change/${e}/`,body:t,hasToken:!0})};