const API_URL="https://api.adventuresinminecraft.com/api/v1";import{SHOP_ITEM_SORT_PRICE_TYPES}from"../contants/constants.js";import*as Types from"../types/types.js";const getTokens=()=>{var e=localStorage.getItem("tokens");return JSON.parse(e)},sendAPIRequest=async({method:t,pathname:s,body:o,hasToken:a})=>{var e=async()=>{var e=a&&getTokens()?.access?{Authorization:"Bearer "+getTokens().access}:{};return(await fetch(API_URL+s,{method:t,body:o&&JSON.stringify(o)||void 0,headers:{"Content-Type":"application/json",...e},redirect:"follow"})).json()};const n=await e();if("token_not_valid"===n?.code){const n=await sendAPIRequestToRefreshToken();if(n?.access)return e();e=window.location.pathname.includes("/ru/")?"ru":"en";window.location.href=`/${e}/pages/login`,localStorage.removeItem("tokens")}return n},sendAPIRequestToRefreshToken=async()=>{const t=getTokens();var e=(await fetch(API_URL+"/user/refresh_token/",{method:"POST",body:JSON.stringify({refresh:t.refresh}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.access},redirect:"follow"})).json();return e.then(e=>{localStorage.setItem("tokens",JSON.stringify({...t,access:e.access}))}),e};export default{signup:e=>sendAPIRequest({method:"POST",pathname:"/user/register/",body:e}),login:e=>sendAPIRequest({method:"POST",pathname:"/user/login/",body:e}),getShopOrdersRequest:()=>sendAPIRequest({method:"GET",pathname:"/shop/orders/",hasToken:!0}),getShopOrderItems:()=>sendAPIRequest({method:"GET",pathname:"/shop/order_items/",hasToken:!0}),getShopItems:async(e,t)=>{var e=await sendAPIRequest({method:"GET",pathname:`/shop/${e}/list/?type=`+t.type}),s=e?.results.map(e=>({...e,sort_price:e.price||e.forever_price}));return t.sort_price===SHOP_ITEM_SORT_PRICE_TYPES.FROM_CHEAP_TO_EXPENSIVE?s.sort((e,t)=>+e.sort_price>+t.sort_price?1:-1):s.sort((e,t)=>+e.sort_price>+t.sort_price?-1:1),{...e,results:s}},getOneShopItem:e=>sendAPIRequest({method:"GET",pathname:`/shop/${e.languageCode}/get/`+e.itemId}),addShopItemToCart:e=>sendAPIRequest({method:"POST",pathname:"/shop/add_to_basket/",body:e,hasToken:!0}),deleteShopItemFromCart:e=>sendAPIRequest({method:"POST",pathname:`/shop/delete_from_basket/${e}/`,hasToken:!0}),updateShopItemInCart:(e,t)=>sendAPIRequest({method:"POST",pathname:`/shop/order_item_change/${e}/`,body:t,hasToken:!0}),updateShopItemDurationInCart:e=>sendAPIRequest({method:"POST",pathname:"/shop/change_duration/",body:e,hasToken:!0}),getShopServersRequest:()=>sendAPIRequest({method:"GET",pathname:"/shop/servers/",hasToken:!0}),createPaymentRequest:e=>sendAPIRequest({method:"POST",pathname:"/payment/create_payment/",body:{...e},hasToken:!0})};