import{languageLocalizations}from"../contants/languageLocalizations.js";import{ContentLoadingEventObserever,LanguageEventObserever}from"../utils/observer.js";import{APP_LANGUAGES,DEFAULT_LANGUAGE}from"../contants/constants.js";const getLanguageFromUrl=(e=window.location)=>{var e=new URL(e).pathname.split("/"),a=e.findIndex(e=>/^[a-z]{2}(-[a-zA-Z]+)?$/.test(e));return-1!==a?e[a]:"en"},getDefaultLanguage=()=>{var e;return localStorage.getItem("language")?(e=navigator.language||navigator.userLanguage,e=APP_LANGUAGES.includes(e.split("-")[0])?e.split("-")[0]:null,getLanguageFromUrl()||localStorage.getItem("language")||e||DEFAULT_LANGUAGE):(window.open(""+window.location.origin+window.location.pathname.replace("/ru","")+window.location.search,"_self"),localStorage.setItem("language","en"),"en")};let defaultLocale=getDefaultLanguage(),locale;const getActiveLocale=()=>locale,setActiveLocale=e=>{locale=e,defaultLocale=e};let translations={};function bindLocaleSwitcher(e){var a=document.querySelector("[data-i18n-switcher]");a&&(a.value=e,a.onchange=e=>{var a;APP_LANGUAGES.slice(1).includes(e.target.value)&&(a=("/"===window.location.pathname?"":window.location.pathname).replace("/"+getLanguageFromUrl(),""),window.open("/"+e.target.value+a+window.location.search,"_self")),"en"===e.target.value&&(a=window.location.pathname==="/"+getLanguageFromUrl?"/":window.location.pathname.replace("/"+getLanguageFromUrl(),""),window.open(""+window.location.origin+a+window.location.search,"_self")),setLocale(e.target.value),localStorage.setItem("language",e.target.value),LanguageEventObserever.broadcast({language:e.target.value})})}async function setLocale(e){var a;e!==locale&&(a=await fetchTranslationsFor(e),locale=e,translations=a,translatePage())}ContentLoadingEventObserever.subscribe(e=>{e&&translatePage()}),document.addEventListener("DOMContentLoaded",()=>{setLocale(defaultLocale),setTimeout(()=>bindLocaleSwitcher(defaultLocale),1e3)});const fetchTranslationsFor=e=>languageLocalizations[e],translatePage=()=>document.querySelectorAll("[data-i18n-key]").forEach(translateElement);function translateElement(e){var a=e.getAttribute("data-i18n-key"),a=translations[a];"INPUT"===e.nodeName&&e.dataset.i18nKey.includes("Placeholder")&&(e.placeholder=a),e.dataset.i18nKey.includes("_desc")&&e.dataset.i18nKey.includes("meta")?e.content=a:e.dataset.i18nKey.includes("InnerHTML")?e.innerHTML=a:e.innerText=a}export{getLanguageFromUrl,getActiveLocale,setActiveLocale,setLocale};