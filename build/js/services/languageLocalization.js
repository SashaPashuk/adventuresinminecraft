import{languageLocalizations}from"../contants/languageLocalizations.js";import{ContentLoadingEventObserever,LanguageEventObserever}from"../utils/observer.js";import{APP_LANGUAGES,DEFAULT_LANGUAGE}from"../contants/constants.js";const getDefaultLanguage=()=>{var e=window.location.pathname.includes("/ru/")?"ru":"en",a=navigator.language||navigator.userLanguage,a=APP_LANGUAGES.includes(a.split("-")[0])?a.split("-")[0]:null,e=e||localStorage.getItem("language")||a||DEFAULT_LANGUAGE;return localStorage.setItem("language",e),e};let defaultLocale=getDefaultLanguage(),locale;const getActiveLocale=()=>locale,setActiveLocale=e=>{locale=e,defaultLocale=e};let translations={};function bindLocaleSwitcher(e){var a=document.querySelector("[data-i18n-switcher]");a&&(a.value=e,a.onchange=e=>{window.open(""+window.location.origin+window.location.pathname.replace("ru"===e.target.value?"/en":"/ru","ru"===e.target.value?"/ru":"/en"),"_self"),setLocale(e.target.value),localStorage.setItem("language",e.target.value),LanguageEventObserever.broadcast({language:e.target.value})})}async function setLocale(e){var a;e!==locale&&(a=await fetchTranslationsFor(e),locale=e,translations=a,translatePage())}ContentLoadingEventObserever.subscribe(e=>{e&&translatePage()}),document.addEventListener("DOMContentLoaded",()=>{setLocale(defaultLocale),bindLocaleSwitcher(defaultLocale)});const fetchTranslationsFor=e=>languageLocalizations[e],translatePage=()=>document.querySelectorAll("[data-i18n-key]").forEach(translateElement);function translateElement(e){var a=e.getAttribute("data-i18n-key"),a=translations[a];"INPUT"===e.nodeName&&e.dataset.i18nKey.includes("Placeholder")&&(e.placeholder=a),e.dataset.i18nKey.includes("_desc")?e.content=a:e.dataset.i18nKey.includes("InnerHTML")?e.innerHTML=a:e.innerText=a}export{getActiveLocale,setActiveLocale,setLocale};