import API from"./services/api.js";import{FIELD_NOT_EMPTY_ERROR,ACTIVE_CODE_INCORRECT,EMAIL_CODE_MIN_CHARACTERS_ERROR,EMAIL_CODE_MAX_CHARACTERS_ERROR,errorsLanguageLocalizationsEnum}from"./contants/errors.js";import{ContentLoadingEventObserever}from"./utils/observer.js";import{getLocalizedError}from"./services/errorsLanguageLocalization.js";import{addToastNotification}from"./utils/helpers.js";const loginButtonElement=document.querySelector("#login-button"),loginFormElement=document.querySelector("#login-form"),loginFormContainerElement=document.querySelector("#login-from-container"),codeFormContainerElement=document.querySelector("#code-from-container"),codeButtonElement=document.querySelector("#code-button"),codeFormElement=document.querySelector("#code-form"),takeDataFromFormInputs=(document.addEventListener("DOMContentLoaded",()=>{localStorage.getItem("register_success")&&(addToastNotification({message:getLocalizedError(errorsLanguageLocalizationsEnum.USER_REGISTERED_SUCCESS)}),localStorage.removeItem("register_success"))}),loginButtonElement?.addEventListener("click",e=>{e.preventDefault(),cleanFormFromErrors(loginFormElement);const t=takeDataFromFormInputs(loginFormElement);API.login({email_code:"string",username:t.username,password:t.password}).then(e=>{var o=e?.username&&e?.username[0]||"",r=e?.password&&e?.password[0]||"";[FIELD_NOT_EMPTY_ERROR].includes(o)&&((loginFormElement?.querySelector('label[for="username"]')).innerHTML=getLocalizedError(errorsLanguageLocalizationsEnum.FIELD_NOT_EMPTY_ERROR)),[FIELD_NOT_EMPTY_ERROR].includes(r)&&((loginFormElement?.querySelector('label[for="password"]')).innerHTML=getLocalizedError(errorsLanguageLocalizationsEnum.FIELD_NOT_EMPTY_ERROR)),e?.detail===ACTIVE_CODE_INCORRECT&&((loginFormElement?.querySelector('label[for="password"]')).innerHTML=getLocalizedError(errorsLanguageLocalizationsEnum.ACTIVE_CODE_INCORRECT)),"Email code has been sent."===e?.detail&&(localStorage.setItem("login",JSON.stringify(t)),codeFormContainerElement.classList.remove("hidden"),loginFormContainerElement.classList.add("hidden")),e?.refresh&&e?.access&&(localStorage.removeItem("login"),localStorage.setItem("username",t.username),localStorage.setItem("tokens",JSON.stringify(e)),window.location.href="/home")})}),codeButtonElement?.addEventListener("click",e=>{e.preventDefault(),cleanFormFromErrors(codeFormElement);const r=localStorage.getItem("login");e=takeDataFromFormInputs(codeFormElement);API.login({email_code:e.code,...JSON.parse(r)}).then(e=>{var o=e?.email_code&&e?.email_code[0]||"";[FIELD_NOT_EMPTY_ERROR,EMAIL_CODE_MIN_CHARACTERS_ERROR,EMAIL_CODE_MAX_CHARACTERS_ERROR].includes(o)&&((codeFormElement?.querySelector('label[for="code"]')).innerHTML=getLocalizedError(o===FIELD_NOT_EMPTY_ERROR?errorsLanguageLocalizationsEnum.FIELD_NOT_EMPTY_ERROR:o===EMAIL_CODE_MIN_CHARACTERS_ERROR?errorsLanguageLocalizationsEnum.EMAIL_CODE_MIN_CHARACTERS_ERROR:errorsLanguageLocalizationsEnum.EMAIL_CODE_MAX_CHARACTERS_ERROR)),e?.refresh&&e?.access&&(localStorage.removeItem("login"),localStorage.setItem("username",JSON.parse(r).username),localStorage.setItem("tokens",JSON.stringify(e)),window.location.href="/home")})}),document.addEventListener("DOMContentLoaded",()=>{localStorage.getItem("login")&&(loginFormContainerElement.classList.add("hidden"),codeFormContainerElement.classList.remove("hidden")),ContentLoadingEventObserever.broadcast(!0)}),e=>{e=e?.querySelectorAll("input");return Array.from(e).reduce((e,o)=>({...e,[o.getAttribute("name")]:o.value}),{})}),cleanFormFromErrors=e=>{e=e?.querySelectorAll("label");Array.from(e).slice(0,2).forEach(e=>e.innerHTML="")};